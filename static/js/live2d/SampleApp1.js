function sampleApp1(){this.platform=window.navigator.platform.toLowerCase(),this.live2DMgr=new LAppLive2DManager,this.isDrawStart=!1,this.gl=null,this.canvas=null,this.dragMgr=null,this.viewMatrix=null,this.projMatrix=null,this.deviceToScreen=null,this.drag=!1,this.oldLen=0,this.lastMouseX=0,this.lastMouseY=0,this.isModelShown=!1,initL2dCanvas("glcanvas"),init()}function initL2dCanvas(a){this.canvas=document.getElementById(a),this.canvas.addEventListener&&(this.canvas.addEventListener("mousewheel",mouseEvent,!1),this.canvas.addEventListener("click",mouseEvent,!1),this.canvas.addEventListener("mousedown",mouseEvent,!1),this.canvas.addEventListener("mousemove",mouseEvent,!1),this.canvas.addEventListener("mouseup",mouseEvent,!1),this.canvas.addEventListener("mouseout",mouseEvent,!1),this.canvas.addEventListener("contextmenu",mouseEvent,!1),this.canvas.addEventListener("touchstart",touchEvent,!1),this.canvas.addEventListener("touchend",touchEvent,!1),this.canvas.addEventListener("touchmove",touchEvent,!1)),btnChangeModel=document.getElementById("btnChange"),btnChangeModel.addEventListener("click",function(a){changeModel()})}function init(){var a=this.canvas.width,b=this.canvas.height;this.dragMgr=new L2DTargetPoint;var c=b/a,d=LAppDefine.VIEW_LOGICAL_LEFT,e=LAppDefine.VIEW_LOGICAL_RIGHT,f=-c,g=c;return this.viewMatrix=new L2DViewMatrix,this.viewMatrix.setScreenRect(d,e,f,g),this.viewMatrix.setMaxScreenRect(LAppDefine.VIEW_LOGICAL_MAX_LEFT,LAppDefine.VIEW_LOGICAL_MAX_RIGHT,LAppDefine.VIEW_LOGICAL_MAX_BOTTOM,LAppDefine.VIEW_LOGICAL_MAX_TOP),this.viewMatrix.setMaxScale(LAppDefine.VIEW_MAX_SCALE),this.viewMatrix.setMinScale(LAppDefine.VIEW_MIN_SCALE),this.projMatrix=new L2DMatrix44,this.projMatrix.multScale(1,a/b),this.deviceToScreen=new L2DMatrix44,this.deviceToScreen.multTranslate(-a/2,-b/2),this.deviceToScreen.multScale(2/a,-2/a),this.gl=getWebGLContext(),this.gl?(Live2D.setGL(this.gl),this.gl.clearColor(0,0,0,0),changeModel(),void startDraw()):void l2dError("Failed to create WebGL context.")}function startDraw(){this.isDrawStart||(this.isDrawStart=!0,function a(){draw();var b=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;b(a,this.canvas)}())}function draw(){MatrixStack.reset(),MatrixStack.loadIdentity(),this.dragMgr.update(),this.live2DMgr.setDrag(this.dragMgr.getX(),this.dragMgr.getY()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),MatrixStack.multMatrix(projMatrix.getArray()),MatrixStack.multMatrix(viewMatrix.getArray()),MatrixStack.push();for(var a=0;a<this.live2DMgr.numModels();a++){var b=this.live2DMgr.getModel(a);if(null==b)return;if(b.initialized&&!b.updating&&(b.update(),b.draw(this.gl),!this.isModelShown&&a==this.live2DMgr.numModels()-1)){this.isModelShown=!this.isModelShown;var c=document.getElementById("btnChange");c.textContent="Change Model",c.removeAttribute("disabled"),c.setAttribute("class","active")}}MatrixStack.pop()}function changeModel(){var a=document.getElementById("btnChange");a.setAttribute("disabled","disabled"),a.setAttribute("class","inactive"),a.textContent="Now Loading...",this.isModelShown=!1,this.live2DMgr.reloadFlg=!0,this.live2DMgr.count++,this.live2DMgr.changeModel(this.gl)}function modelScaling(a){var b=thisRef.viewMatrix.isMaxScale(),c=thisRef.viewMatrix.isMinScale();thisRef.viewMatrix.adjustScale(0,0,a),b||thisRef.viewMatrix.isMaxScale()&&thisRef.live2DMgr.maxScaleEvent(),c||thisRef.viewMatrix.isMinScale()&&thisRef.live2DMgr.minScaleEvent()}function modelTurnHead(a){thisRef.drag=!0;var b=a.target.getBoundingClientRect(),c=transformScreenX(a.clientX-b.left),d=transformScreenY(a.clientY-b.top),e=transformViewX(a.clientX-b.left),f=transformViewY(a.clientY-b.top);LAppDefine.DEBUG_MOUSE_LOG&&l2dLog("onMouseDown device( x:"+a.clientX+" y:"+a.clientY+" ) view( x:"+e+" y:"+f+")"),thisRef.lastMouseX=c,thisRef.lastMouseY=d,thisRef.dragMgr.setPoint(e,f),thisRef.live2DMgr.tapEvent(e,f)}function followPointer(a){var b=a.target.getBoundingClientRect(),c=transformScreenX(a.clientX-b.left),d=transformScreenY(a.clientY-b.top),e=transformViewX(a.clientX-b.left),f=transformViewY(a.clientY-b.top);LAppDefine.DEBUG_MOUSE_LOG&&l2dLog("onMouseMove device( x:"+a.clientX+" y:"+a.clientY+" ) view( x:"+e+" y:"+f+")"),thisRef.drag&&(thisRef.lastMouseX=c,thisRef.lastMouseY=d,thisRef.dragMgr.setPoint(e,f))}function lookFront(){thisRef.drag&&(thisRef.drag=!1),thisRef.dragMgr.setPoint(0,0)}function mouseEvent(a){if(a.preventDefault(),"mousewheel"==a.type){if(a.clientX<0||thisRef.canvas.clientWidth<a.clientX||a.clientY<0||thisRef.canvas.clientHeight<a.clientY)return;modelScaling(a.wheelDelta>0?1.1:.9)}else if("mousedown"==a.type){if("button"in a&&0!=a.button)return;modelTurnHead(a)}else if("mousemove"==a.type)followPointer(a);else if("mouseup"==a.type){if("button"in a&&0!=a.button)return;lookFront()}else"mouseout"==a.type?lookFront():"contextmenu"==a.type&&changeModel()}function touchEvent(a){a.preventDefault();var b=a.touches[0];if("touchstart"==a.type)1==a.touches.length&&modelTurnHead(b);else if("touchmove"==a.type){if(followPointer(b),2==a.touches.length){var c=a.touches[0],d=a.touches[1],e=Math.pow(c.pageX-d.pageX,2)+Math.pow(c.pageY-d.pageY,2);modelScaling(thisRef.oldLen-e<0?1.025:.975),thisRef.oldLen=e}}else"touchend"==a.type&&lookFront()}function transformViewX(a){var b=this.deviceToScreen.transformX(a);return viewMatrix.invertTransformX(b)}function transformViewY(a){var b=this.deviceToScreen.transformY(a);return viewMatrix.invertTransformY(b)}function transformScreenX(a){return this.deviceToScreen.transformX(a)}function transformScreenY(a){return this.deviceToScreen.transformY(a)}function getWebGLContext(){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],b=0;b<a.length;b++)try{var c=this.canvas.getContext(a[b],{premultipliedAlpha:!0});if(c)return c}catch(a){}return null}function l2dLog(a){if(LAppDefine.DEBUG_LOG){var b=document.getElementById("myconsole");b.innerHTML=b.innerHTML+"<br>"+a,console.log(a)}}function l2dError(a){LAppDefine.DEBUG_LOG&&(l2dLog("<span style='color:red'>"+a+"</span>"),console.error(a))}var thisRef=this;window.onerror=function(a,b,c,d,e){var f="file:"+b+"<br>line:"+c+" "+a;l2dError(f)};